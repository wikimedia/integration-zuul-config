- project:
    name: 'pywikibot-bots-CommonsDelinker'
    toxenv:
     - flake8
    jobs:
     - '{name}-tox-{toxenv}'

- project:
    name: pywikibot-compat

    jobs:
     - python-jobs

- project:
    name: pywikibot-core
    toxenv:
     - flake8-py3  # must only trigger the '-jessie' version
     - flake8-docstrings
     - flake8-docstrings-mandatory
     - nose
     - nose34  # must only trigger the '-jessie' version

    jobs:
     - '{name}-tox-doc-publish':
        docsrc: 'docs/_build/html'
        docdest: 'pywikibot'
     - '{name}-tox-{toxenv}'
     - '{name}-tox-{toxenv}-jessie'

- project:
    name: pywikibot-i18n

    jobs:
     - python-jobs

- job:
    name: pywikibot-tests-beta-cluster
    node: contintLabsSlave && UbuntuTrusty
    scm:
      - git:
          url: 'https://gerrit.wikimedia.org/r/pywikibot/core'
          branches:
            - master
          wipe-workspace: false  # keep the workspace...
          clean:
              after: true        # ... and use git clean instead
          prune: true            # prune remote obsoletes branches
          submodule:
              recursive: false
    builders:
     - shell: |
         export PYWIKIBOT2_DIR=$WORKSPACE
         tox -e venv -- python -m generate_family_file 'http://en.wikipedia.beta.wmflabs.org/' 'wpbeta' 'y'
         tox -e venv -- python -m generate_user_files -dir:$WORKSPACE -family:wpbeta -lang:en -v
         echo "console_encoding='utf8'" >> $WORKSPACE/user-config.py
         tox -e venv pip install nose
         tox -e venv -- python setup.py nosetests --tests tests --verbosity=2 -a '"family=wpbeta,code=en"'
    triggers:
        - timed: "@midnight"

- project:
    name: pywikibot-wikibase
    toxenv:
     - flake8-py3
     - nose
     - nose34

    jobs:
     - '{name}-tox-{toxenv}'
     - '{name}-tox-{toxenv}-jessie'
