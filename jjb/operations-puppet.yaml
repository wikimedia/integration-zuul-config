# Trigger integration tests hold in 'tests' sub directories as manifests.
# See the shell wrapper in integration/jenkins.git
- job-template:
    name: 'operations-puppet-test'
    node: contintLabsSlave && UbuntuTrusty
    defaults: use-remoteonly-zuul
    concurrent: true
    triggers:
     - zuul

    builders:
     - shell: "/srv/deployment/integration/slave-scripts/bin/puppet-test-runner.sh"

# Testing puppet compiler currently so adding -test prefix on the end.
- job-template:
    name: 'operations-puppet-catalog-compiler-test'
    node: compiler02.puppet3-diffs.eqiad.wmflabs
    defaults: use-remoteonly-zuul
    concurrent: false  # dont want to race doc creation!
    triggers:
     - zuul

# Documentation for our puppet repository
- job-template:
    name: 'operations-puppet-doc'
    node: contintLabsSlave && UbuntuTrusty
    defaults: use-remoteonly-zuul
    concurrent: false  # dont want to race doc creation!

    triggers:
     - zuul
    scm:
     - git:
         url: '$ZUUL_URL/$ZUUL_PROJECT'
         basedir: 'src'
         branches:
             - '$ZUUL_COMMIT'
         refspec: '$ZUUL_REF'
         wipe-workspace: false
         clean:
             after: true
         submodule:
             disable: false
             recursive: true
    builders:
     - puppet-doc:
        puppet: "$WORKSPACE"
     - doc-publish:
        docsrc: 'doc'
        docdest: 'puppet'
     # And publish the entire workspace as "puppetsource"
     - doc-publish:
        docsrc: 'src'
        docdest: 'puppetsource'

- project:
    name: 'operations-puppet'
    jobs:
     - '{name}-puppetlint-strict'
     - '{name}-typos'
     - '{name}-tox-jessie'
     - operations-puppet-test
     - operations-puppet-doc
