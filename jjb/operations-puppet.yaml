# Documentation for our puppet repository
- job-template:
    name: 'operations-puppet-doc'
    node: ci-jessie-wikimedia
    defaults: use-remoteonly-zuul
    concurrent: false  # dont want to race doc creation!

    triggers:
     - pollscm:
         cron: '@hourly'
    scm:
     - git:
         url: 'https://gerrit.wikimedia.org/r/p/operations/puppet.git'
         branches:
             - production
         reference-repo: '/srv/git/operations/puppet.git'
         submodule:
             disable: false
             recursive: true
         basedir: 'src'

    builders:
     - puppet-doc:
        puppet: "$WORKSPACE/src"
     - doc-publish:
        docsrc: 'doc'
        docdest: 'puppet'
     # And publish the entire workspace as "puppetsource"
     - shell: |
         rm -fR src/.git
     - doc-publish:
        docsrc: 'src'
        docdest: 'puppetsource'
    publishers:
     - email-ext:
         recipients: qa-alerts@lists.wikimedia.org
         attach-build-log: true
         first-failure: true
         aborted: true
         failure: false
         fixed: true


- project:
    name: 'operations-puppet'
    jobs:
     - '{name}-typos'
     - '{name}-tox-jessie'
     - operations-puppet-doc
