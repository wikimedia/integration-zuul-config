- publisher:
    name: gradle-reports-checkstyle
    publishers:
     - checkstyle:
         pattern: "**/build/reports/checkstyle/checkstyle.xml"
         can-run-on-failed: true
         healthy: 0
         unhealthy: 100
         thresholds:
           failed:
               total-all: 1

- publisher:
    name: irc-android-ci
    publishers:
     - ircbot:
         message-type: summary-scm-fail
         channels:
             - name: '#wikimedia-android-ci'
               notify-only: true

- job-template:
    name: 'apps-android-wikipedia-test'
    node: contintLabsSlave && DebianJessie
    jdk: 'Debian - OpenJdk 8'
    defaults: use-remoteonly-zuul
    concurrent: true
    triggers:
     - zuul
    properties:
     - build-discarder:
         days-to-keep: 15
    wrappers:
     - timeout:
         timeout: 30
         fail: true
     - timestamps
     - ansicolor
    builders:
     - shell: scripts/apps-android-wikipedia-test
    publishers:
     - archive:
         # Capture generated .apk, ProGuard mappings, checkstyle.xml, and test results
         artifacts: '**/build/outputs/**,**/build/reports/**,**/test-results/**/*.xml'
     - gradle-reports-checkstyle
     - junit:
        results: '**/test-results/**/*.xml'
     # FIXME raw xml for the Android Lint plugin T161305
     - raw:
         xml: |
             <org.jenkinsci.plugins.android__lint.LintPublisher>
               <canRunOnFailed>true</canRunOnFailed>
               <pattern>**/build/reports/**/lint-results-*.xml</pattern>
             </org.jenkinsci.plugins.android__lint.LintPublisher>

- job-template:
    name: 'apps-android-wikipedia-publish'
    node: contintLabsSlave && DebianJessie
    jdk: 'Debian - OpenJdk 8'
    defaults: use-remoteonly-zuul
    concurrent: true
    triggers:
     - zuul
    wrappers:
     - timeout:
         timeout: 30
         fail: true
     - timestamps
     - ansicolor
    builders:
     - shell: scripts/apps-android-wikipedia-publish
    publishers:
     - archive:
         # Capture generated .apk and meta.json
         artifacts: '**/build/outputs/**,meta.json'
     - irc-android-ci

- project:
    name: 'apps-android-wikipedia'
    jobs:
      - '{name}-tox-docker'
      - '{name}-npm-node-6-docker'
      - 'apps-android-wikipedia-test'
      - 'apps-android-wikipedia-publish'
