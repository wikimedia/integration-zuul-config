- project:
    name: search
    javadocgoals: clean javadoc:javadoc
    project:
        - extra
        - highlighter:
            # highlighter is a multi-modules project and javadoc:javadoc goal
            # fails due to missing dependencies that are built via "package".
            # Also have to aggregate all the modules doc in the parent folder
            # via javadoc:aggregate
            # Tests are skipped entirely, since 'search-{project}' already runs
            # them.
            javadocgoals: 'clean package javadoc:aggregate -Dmaven.test.skip=true'
        - ltr
        - repository-swift
    jobs:
        - 'search-{project}'
        - 'search-{project}-javadoc'
        - 'search-{project}-javadoc-publish'

- job-template:
    name: 'search-{project}'
    project-type: maven
    jdk: 'Ubuntu - OpenJdk 8'
    node: ci-jessie-wikimedia
    concurrent: true
    triggers:
     - zuul
    properties:
     - build-discarder:
         days-to-keep: 15
    scm:
     - git-remoteonly-zuul
    wrappers:
     - timeout:
         timeout: 60  # minutes
         fail: true
     - timestamps
     - ansicolor
    prebuilders:
     - castor-load
    maven:
      goals: clean package
    publishers:
     - castor-save

- job-template:
    name: 'search-{project}-javadoc'
    project-type: maven
    jdk: 'Ubuntu - OpenJdk 8'
    node: ci-jessie-wikimedia
    concurrent: true
    triggers:
     - zuul
    properties:
     - build-discarder:
         days-to-keep: 15
    scm:
     - git-remoteonly-zuul
    wrappers:
     - timeout:
         timeout: 60  # minutes
         fail: true
     - timestamps
     - ansicolor
    prebuilders:
     - castor-load
    maven:
      goals: '{javadocgoals}'
    publishers:
     - castor-save

- job-template:
    name: 'search-{project}-javadoc-publish'
    project-type: maven
    jdk: 'Ubuntu - OpenJdk 8'
    node: ci-jessie-wikimedia
    concurrent: true
    triggers:
     - zuul
    properties:
     - build-discarder:
         days-to-keep: 15
    scm:
     - git-remoteonly-zuul
    wrappers:
     - timeout:
         timeout: 60  # minutes
         fail: true
     - timestamps
     - ansicolor
    prebuilders:
     - castor-load
    maven:
      goals: '{javadocgoals}'
    postbuilders:
     - doc-publish:
         docsrc: 'target/site/apidocs'
         docdest: 'search-{project}'
    publishers:
     - castor-save
