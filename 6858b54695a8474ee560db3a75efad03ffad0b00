{
  "comments": [
    {
      "key": {
        "uuid": "4e7eab26_91436867",
        "filename": "dockerfiles/contint-operations-puppet/Dockerfile",
        "patchSetId": 8
      },
      "lineNbr": 26,
      "author": {
        "id": 24
      },
      "writtenOn": "2017-09-13T08:04:03Z",
      "side": 1,
      "message": "We need a full clone or you end up with random breakage when fetching from the zuul-merger.\n\nEg if one send a chain of patches A, B, C you would fetch from the zuul-merger a zuul/ref which is the merge of C into production:\n\n\n (production)-----------------(merge zuul/ref into production)\n   \\---A---B---C (zuul/ref)---/\n\nI clearly remember that \"git fetch zuul/ref\" would end up complaining because it lacks object of A / B and potentially production.\n\n\nIf the goal is to speed up the container creation, we can use a git cache on the host and attach it as a read-only volume to clone from.  I did something like that in quibble:\n\n mkdir -p ref/mediawiki\n git clone --bare mediawiki/core ref/mediawiki/core.git\n git clone --bare mediawiki/vendor ref/mediawiki/vendor.git\n\nThen:\n\n docker run -v `pwd`/ref:/srv/git:ro\n\nAnd inside the container:\n\n git clone --reference /srv/git/mediawiki/core.git\n\nOr\n\n  zuul-cloner --cache-dir /srv/git",
      "revId": "6858b54695a8474ee560db3a75efad03ffad0b00",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e7eab26_510d0040",
        "filename": "dockerfiles/contint-operations-puppet/Dockerfile",
        "patchSetId": 8
      },
      "lineNbr": 26,
      "author": {
        "id": 106
      },
      "writtenOn": "2017-09-13T08:13:43Z",
      "side": 1,
      "message": "\"when fetching from the zuul-merger\".\nDo you mean git://contint2001.wikimedia.org/operations/puppet ? or?\n\ngit fetch zuul/ref should sort out all of the objects that it needs, you can do it in a totally bare repo and literally \"git init \u0026\u0026 git fetch zuul/ref\" and it will fetch the ref correctly / figure out which objects it needs.\n\nThe goal is indeed to speed up the container creation, and run of the container.\nI would be against building something into this image such as a git cache and infact I think the fetching of the code should be done in a seperate container.\nThis allows these test containers to also be run easily on devs machines.\nSee: https://gerrit.wikimedia.org/r/#/c/375834\n\nDo you have any previous tickets of jenkins runs that show the complaining because it lacks object of A / B?",
      "parentUuid": "4e7eab26_91436867",
      "revId": "6858b54695a8474ee560db3a75efad03ffad0b00",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e7eab26_3c3dabb8",
        "filename": "dockerfiles/contint-operations-puppet/Dockerfile",
        "patchSetId": 8
      },
      "lineNbr": 26,
      "author": {
        "id": 24
      },
      "writtenOn": "2017-09-13T08:23:39Z",
      "side": 1,
      "message": "\u003e \u003e \"when fetching from the zuul-merger\".\n\u003e Do you mean git://contint2001.wikimedia.org/operations/puppet ? or?\n\nYes that is it :]\n\n\nI could not find a task about the fetch failure.  That definitely happened on operations/puppet and mediawiki/core which had a shallow clone for php55 linting.  Anytime someone sent a chain of patches, the jobs would die out horribly.\n\nBut I guess I can try to reproduce and see whether that is still a concern.",
      "parentUuid": "4e7eab26_510d0040",
      "revId": "6858b54695a8474ee560db3a75efad03ffad0b00",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    }
  ]
}