FROM {{ "dev-stretch" | image_tag }} AS dev-stretch

# Note that WMF APT key is pre-installed.
# See: https://wikitech.wikimedia.org/wiki/APT_repository#Security

RUN echo "deb https://apt.wikimedia.org/wikimedia stretch-wikimedia component/php72" \
   > /etc/apt/sources.list.d/wikimedia-php72.list

# Install PHP dependencies:

# Not installing php-tidy here - see https://phabricator.wikimedia.org/T191771
{% set mediawiki_deps|replace('\n', ' ') -%}
php-apcu
php-bcmath
php-cli
php-curl
php-gd
php-gmp
php-intl
php-ldap
php-mbstring
php-mysql
php-pgsql
php-sqlite3
php-xml
php-zip
{%- endset -%}

RUN {{ mediawiki_deps | apt_install }}

# Install XDebug but disable it by default due to its performance impact:
RUN {{ "php-xdebug" | apt_install }} \
    && phpdismod xdebug

# Install composer:
RUN git clone --depth 1 https://gerrit.wikimedia.org/r/p/integration/composer.git /srv/composer \
    && rm -rf /srv/composer/.git \
    && ln -s /srv/composer/vendor/bin/composer /usr/bin/composer
